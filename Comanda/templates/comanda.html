{% extends 'main.html'%}
{%block extra_css%}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />

<style>
  .card {
      width: 18rem;
      height: 25rem;
      margin: 15px;
  }

  @media (max-width: 1400px) {
      .card {
          width: calc(95%);
      }
  }

  @media (max-width: 1200px) {
      .card {
          width: calc(90%); 
      }
  }

  @media (max-width: 992px) {
      .card {
          width: calc(90%);
      }
  }
  
</style>

{% endblock extra_css %}
{% block contenido %}
{% comment %} <nav class="navbar navbar-expand-lg navbar-light " style="background-color: #ffffff; color: #ffffff;">
    <div class="container-fluid">
      <a class="navbar-brand" href="{% url 'Menu'  %}" style="color: #8B4513; font-size: 25px;">Menú</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">

        {% for categoria in categorias %}
        <li class="nav-item">
          <a class="nav-link" href="{% url 'comanda_por_categoria' categoria_id=categoria.id %}">{{ categoria.nombreCate }}</a>        
        </li>
        {% endfor %}          
        </ul>

        <form class="d-flex" method= "GET">
          <input class="form-control me-2" type="search" placeholder="Buscar platillo" aria-label="Search" name="Buscar" value="">
          <button class="btn btn-outline-success custom-brown" type="submit"  >Buscar</button>
        </form>

      </div>
    </div>
  </nav>    {% endcomment %}

<h1> Seleccione el tipo de orden: </h1>

<div class="row">
    <div class="col-md-6">
        <div>
            <button type="button" class="btn btn-primary" name="tipoEntrega" value="en-sitio" onclick="mostrarMesas()" style="background-color: #9f663e; border-color:  #9f663e; margin-right: 15px">
                <i class="fas fa-utensils"></i> En sitio
            </button>
            <button type="button" class="btn btn-primary" name="tipoEntrega" value="a-domicilio" onclick="mostrarFormulario()" style="background-color: #9f663e; border-color:  #9f663e; margin-right: 15px ">
                <i class="fas fa-motorcycle"></i> A domicilio
            </button>

            <a class="btn btn-primary" href="{% url 'VerComanda' %}">
                Ver Ordenes <i class="fas fa-shopping-cart"></i>
            </a>
            
        </div>
           
    </div>    
    
</div>



{% for mesa in mesas %}
<form method="post" action="{% url 'carrito_por_mesa' mesa_id=mesa.id %}">
    {% csrf_token %}    

    
    
    <div id="mesasDisponibles" style="display: none; margin-top: 20px;">
        <select class="form-select form-select-sm" name="mesa_id" id="Mesa">
            {% for mesa in mesas %}
                <option value="{{ mesa.id }}">Mesa {{ mesa.numero }}</option>
            {% endfor %}
        </select>

                
        <div class="input-group" style="margin-top: 15px">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
            <input type="text" id="search-input" name="search" class="form-control" placeholder="Buscar productos">
        </div>
        
        <!-- Agrega el contenedor de productos donde se mostrarán los resultados de búsqueda -->
        <div id="productos-container" class="row">
            {% for producto in productos %}
            <div class="col-lg-4 col-md-6 col-sm-12">
                <div class="card card-item">
                    {% if producto.imagen %}
                        <img src="{{ producto.imagen.url }}" class="card-img-top" style="width: 100%; height:200px;" alt="..." >
                    {% else %}
                        <div class="card-placeholder" style="width: 100%; height:200px; background-color: #eee; text-align: center; line-height: 200px;">
                            Sin imagen
                        </div>
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ producto.nombre }}</h5>
                        <p class="card-text">Precio: ${{ producto.precio }} MXN</p>
                        {% for sabor in producto.sabores %}
                            <input class="form-check-input" type="checkbox" value="{{ sabor }}" name="sabores">
                            <label class="form-check-label">{{ sabor }}</label><br>
                        {% endfor %}
    
                        <input class= "form-control" type="number" name="cantidad" style="width: 65px; height: 25px; position: absolute; bottom: 10px; right: 20px;" value="1" min="1">
                        <input type="hidden" name="id_producto" value ="{{ producto.id }}">
                        
                    </div>
                </div>
            </div>
        {% endfor %}
        </div>

        <button type="submit" class="btn btn-primary">Agregar al Carrito <i class="bi bi-plus-circle-fill"></i></button>

        <a class="btn btn-primary" href="{% url 'carrito_por_mesa' mesa.id %}">
            Ver Ordenes <i class="fas fa-shopping-cart"></i>
        </a>
        
    </div>
</form>
{% endfor %}


<form id="formularioDomicilio" style="display: none; margin-top: 20px;" method="post" action="{% url 'carrito_pedido_domicilio' %}">
    {% csrf_token %}
    <h3> Añada los datos del domicilio del Cliente: </h3>

    <label for="Nombre">Nombre: </label>
    <input type="text" name="nombre"/>

    <label for="Nombre">Dirección: </label>
    <input type="text" name="direccion"/>

    <label for="Nombre">Número de Teléfono: </label>
    <input type="tel" name="numero" id="Telephone"/>
    <div class="row">

        {% for producto in productos %}
            <div class="col-lg-4 col-md-6 col-sm-12">
                <div class="card card-item">
                    {% if producto.imagen %}
                        <img src="{{ producto.imagen.url }}" class="card-img-top" style="width: 100%; height:200px;" alt="..." >
                    {% else %}
                        <div class="card-placeholder" style="width: 100%; height:200px; background-color: #eee; text-align: center; line-height: 200px;">
                            Sin imagen
                        </div>
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ producto.nombre }}</h5>
                        <p class="card-text">Precio: ${{ producto.precio }} MXN</p>
                            {% for sabor in producto.sabores %}
                                <input class="form-check-input" type="checkbox" value="{{ sabor }}" name="sabores">
                                <label class="form-check-label">{{ sabor }}</label><br>
                            {% endfor %}
    
                            <input type="number" name="cantidad" style="width: 50px; height: 25px; position: absolute; bottom: 10px; right: 20px;" value="1" min="1">
                            <input type="hidden" name="id_producto" value ="{{ producto.id }}">
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
    <button type="submit" class="btn btn-primary">Agregar al Carrito <i class="bi bi-plus-circle-fill"></i></button>
</form>

<a href="{% url 'Dashboard' %}" class="btn btn-danger" style="margin-top: 15px; margin-bottom: 15px;">Cancelar </a>


<!--Mmuestra y oculta segun la seleccion-->
<script>
    function mostrarFormulario() {
        document.getElementById("formularioDomicilio").style.display = "block";
        document.getElementById("mesasDisponibles").style.display = "none";
    }

    function mostrarMesas() {
        document.getElementById("formularioDomicilio").style.display = "none";
        document.getElementById("mesasDisponibles").style.display = "block";
    }
</script>
{% endblock contenido%}

{% block extra_js%}


<!-- ... (Código anterior) -->

<script>
    $(document).ready(function () {
        $('#search-input').on('input', function () {
            var query = $(this).val();

            $.ajax({
                url: '{% url "buscar_productos" %}',
                data: { 'q': query },
                dataType: 'json',
                success: function (data) {
                    // Limpia el contenedor de productos antes de mostrar los resultados de búsqueda
                    $('#productos-container').empty();

                    // Itera sobre los resultados y agrega cada producto al contenedor
                    $.each(data, function (index, producto) {
                        var cardHtml = '<div class="col-lg-4 col-md-6 col-sm-12">';
                        cardHtml += '<div class="card card-item">';

                        // Comprobación de la existencia de la imagen
                        if (producto.imagen) {
                            var img = new Image();
                            img.src = producto.imagen;

                            // Manejar la carga exitosa de la imagen
                            img.onload = function () {
                                cardHtml += '<img src="' + producto.imagen + '" class="card-img-top" style="width: 100%; height:200px;" alt="...">';
                                cardHtml += '<div class="card-body">';
                                cardHtml += '<h5 class="card-title">' + producto.nombre + '</h5>';
                                cardHtml += '<p class="card-text">Precio: $' + producto.precio + ' MXN</p>';
                                
                                // Comprobación y generación de checkboxes para los sabores
                                $.each(producto.sabores, function (index, sabor) {
                                    cardHtml += '<input class="form-check-input" type="checkbox" value="' + sabor + '" name="sabores">';
                                    cardHtml += '<label class="form-check-label">' + sabor + '</label><br>';
                                });

                                // Resto del código HTML
                                cardHtml += '<input class="form-control" type="number" name="cantidad" style="width: 65px; height: 25px; position: absolute; bottom: 10px; right: 20px;" value="1" min="1">';
                                cardHtml += '<input type="hidden" name="id_producto" value ="' + producto.id + '">';
                                cardHtml += '</div></div></div>';
                                
                                // Agrega el HTML del producto al contenedor
                                $('#productos-container').append(cardHtml);
                            };

                            // Manejar el caso en que la carga de la imagen falla
                            img.onerror = function () {
                                cardHtml += '<div class="card-placeholder" style="width: 100%; height:200px; background-color: #eee; text-align: center; line-height: 200px;">Sin imagen</div>';
                                cardHtml += '<div class="card-body">';
                                cardHtml += '<h5 class="card-title">' + producto.nombre + '</h5>';
                                cardHtml += '<p class="card-text">Precio: $' + producto.precio + ' MXN</p>';
                                
                                // Comprobación y generación de checkboxes para los sabores
                                $.each(producto.sabores, function (index, sabor) {
                                    cardHtml += '<input class="form-check-input" type="checkbox" value="' + sabor + '" name="sabores">';
                                    cardHtml += '<label class="form-check-label">' + sabor + '</label><br>';
                                });

                                // Resto del código HTML
                                cardHtml += '<input class="form-control" type="number" name="cantidad" style="width: 65px; height: 25px; position: absolute; bottom: 10px; right: 20px;" value="1" min="1">';
                                cardHtml += '<input type="hidden" name="id_producto" value ="' + producto.id + '">';
                                cardHtml += '</div></div></div>';
                                
                                // Agrega el HTML del producto al contenedor
                                $('#productos-container').append(cardHtml);
                            };
                        } else {
                            cardHtml += '<div class="card-placeholder" style="width: 100%; height:200px; background-color: #eee; text-align: center; line-height: 200px;">Sin imagen</div>';
                            cardHtml += '<div class="card-body">';
                            cardHtml += '<h5 class="card-title">' + producto.nombre + '</h5>';
                            cardHtml += '<p class="card-text">Precio: $' + producto.precio + ' MXN</p>';
                            
                            // Comprobación y generación de checkboxes para los sabores
                            $.each(producto.sabores, function (index, sabor) {
                                cardHtml += '<input class="form-check-input" type="checkbox" value="' + sabor + '" name="sabores">';
                                cardHtml += '<label class="form-check-label">' + sabor + '</label><br>';
                            });

                            // Resto del código HTML
                            cardHtml += '<input class="form-control" type="number" name="cantidad" style="width: 65px; height: 25px; position: absolute; bottom: 10px; right: 20px;" value="1" min="1">';
                            cardHtml += '<input type="hidden" name="id_producto" value ="' + producto.id + '">';
                            cardHtml += '</div></div></div>';
                            
                            // Agrega el HTML del producto al contenedor
                            $('#productos-container').append(cardHtml);
                        }
                    });
                }
            });
        });
    });
</script>



{% endblock extra_js %}